version: "3.7"

networks:
  backend:
    internal: true
    ipam:
      config:
        - subnet: 10.0.0.0/8

volumes:
  postgres-drive:
    name: "postgres-drive"

services:
  
  zeo:
    build: zeodbsync
    ports:
      - 9999
    volumes:
      - type: bind
        source: ./mounts
        target: /vol
    networks:
      - backend
  
  postgres:
    image: postgres:latest
    environment:
      - LANG=en_US.utf8
      - POSTGRES_USER=dockerzope
      - POSTGRES_PASSWORD=12345
      - POSTGRES_HOST_AUTH_METHOD=trust
      - PGDATA=/vol/data
    ports:
      - 5432
    volumes:
      - postgres-drive:/vol
    networks:
      - backend
  
  zope:
    build: zope
    networks:
      - backend
  
  haproxy:
    build: haproxy
    ports:
      - 80
    volumes:
      - type: bind
        source: ./mounts/haproxy
        target: /usr/local/etc/haproxy
    networks:
      - backend